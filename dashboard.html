<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªØ¬Ø±</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    * { box-sizing: border-box; margin:0; padding:0; font-family:'Cairo',sans-serif; }
    body { background:#f4f7f6; color:#333; }
    header { background:#0b5fa5; color:#fff; padding:20px; text-align:center; font-size:24px; font-weight:bold; }
    .container { max-width:1200px; margin:auto; padding:20px; }
    h2 { margin:20px 0 10px; color:#0b5fa5; }
    .card { background:#fff; padding:20px; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.1); margin-bottom:30px; }
    table { width:100%; border-collapse: collapse; margin-top:10px; }
    th, td { border:1px solid #ddd; padding:8px; text-align:center; }
    th { background:#0b5fa5; color:#fff; }
    button { padding:5px 10px; border:none; border-radius:8px; cursor:pointer; }
    .btn-edit { background:#4caf50; color:#fff; }
    .btn-delete { background:#f44336; color:#fff; }
    .btn-download { background:#0b5fa5; color:#fff; margin-top:10px; display:inline-block; }
    .btn-download-img { background:#083d66; color:#fff; margin-top:10px; display:inline-block; margin-left:10px; }
    .invoice { width:100%; border-collapse: collapse; margin-top:15px; font-size:14px; text-align:center; background:#fff; }
    .invoice th, .invoice td { border:1px solid #0fa36b; padding:8px; }
    .invoice th { background-color:#0fa36b; color:#fff; }
    .invoice tfoot td { background-color:#6bcf63; color:#fff; }
  </style>
</head>
<body>

<header>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø³Ù„Ø©</header>
<div class="container">

  <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
  <h2>ğŸ›’ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø³Ù„Ø©</h2>
  <div class="card">
    <table id="productsTable">
      <thead>
        <tr>
          <th>Ø§Ù„ØµÙˆØ±Ø©</th>
          <th>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</th>
          <th>Ø§Ù„Ø³Ø¹Ø±/ÙƒØº (Ø¯.Ø£)</th>
          <th>Ø§Ù„ÙƒÙ…ÙŠØ© (ÙƒØº)</th>
          <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
  <h2>ğŸ“Š ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</h2>
  <div class="card" id="invoiceCard">
    <table class="invoice" id="invoiceTable">
      <thead>
        <tr>
          <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
          <th>Ø§Ù„ÙƒÙ…ÙŠØ© (ÙƒØº)</th>
          <th>Ø§Ù„Ø³Ø¹Ø±/ÙƒØº (Ø¯.Ø£)</th>
          <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø¯.Ø£)</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <td colspan="3"><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</strong></td>
          <td id="totalAmount"><strong>0 Ø¯.Ø£</strong></td>
        </tr>
      </tfoot>
    </table>
    <button class="btn-download" onclick="downloadInvoicePDF()">â¬‡ï¸ ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© PDF</button>
    <button class="btn-download-img" onclick="downloadInvoiceImage()">ğŸ–¼ï¸ ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙƒØµÙˆØ±Ø©</button>
  </div>

</div>

<script>
  // Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠØ©
  let cart = [
    { name:"Ø¨Ù†Ø¯ÙˆØ±Ø©", price:0.80, quantity:2, img:"images/Ø¨Ù†Ø¯ÙˆØ±Ù‡.jpg" },
    { name:"ØªÙØ§Ø­", price:1.20, quantity:1.5, img:"images/ØªÙØ§Ø­.jpg" },
    { name:"Ø®ÙŠØ§Ø±", price:1.00, quantity:1, img:"images/Ø®ÙŠØ§Ø±.jpg" },
    { name:"ÙÙ„ÙÙ„", price:2.00, quantity:0.5, img:"images/ÙÙ„ÙÙ„.jpg" }
  ];

  // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
  function updateProductsTable() {
    const tbody = document.querySelector("#productsTable tbody");
    tbody.innerHTML = "";
    cart.forEach((item,index)=>{
      const row = document.createElement("tr");
      row.innerHTML = `
        <td><img src="${item.img}" width="50"></td>
        <td>${item.name}</td>
        <td>${item.price.toFixed(2)}</td>
        <td>${item.quantity}</td>
        <td>
          <button class="btn-edit" onclick="editProduct(${index})">âœ ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="btn-delete" onclick="deleteProduct(${index})">ğŸ—‘ Ø­Ø°Ù</button>
        </td>
      `;
      tbody.appendChild(row);
    });
    updateInvoice();
  }

  // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬: ÙŠÙˆØ¯ÙŠÙƒ Ø¹Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
  function editProduct(index){
    window.location.href = "products.html";
  }

  // Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø³Ù„Ø© ÙˆØ§Ù„ÙØ§ØªÙˆØ±Ø© ÙˆØ§Ù„Ø¬Ø¯ÙˆÙ„
  function deleteProduct(index){
    if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ØŸ")){
      cart.splice(index,1);
      updateProductsTable();
    }
  }

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ§ØªÙˆØ±Ø©
  function updateInvoice() {
    const tbody = document.querySelector("#invoiceTable tbody");
    tbody.innerHTML = "";
    let total = 0;
    cart.forEach(item=>{
      const row = document.createElement("tr");
      const itemTotal = (item.quantity*item.price).toFixed(2);
      total += parseFloat(itemTotal);
      row.innerHTML = `
        <td>${item.name}</td>
        <td>${item.quantity}</td>
        <td>${item.price.toFixed(2)}</td>
        <td>${itemTotal}</td>
      `;
      tbody.appendChild(row);
    });
    document.getElementById("totalAmount").innerHTML = `<strong>${total.toFixed(2)} Ø¯.Ø£</strong>`;
  }

  // ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© PDF
  function downloadInvoicePDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({orientation:"p",unit:"mm",format:"a4"});
    doc.setFontSize(18);
    doc.text("ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„",105,15,null,null,"center");
    doc.setFontSize(12);
    let y = 25;
    doc.text(["Ø§Ù„Ù…Ù†ØªØ¬","Ø§Ù„ÙƒÙ…ÙŠØ© (ÙƒØº)","Ø§Ù„Ø³Ø¹Ø±/ÙƒØº","Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ"],15,y);
    y+=8;
    let total = 0;
    cart.forEach(item=>{
      const itemTotal = (item.price*item.quantity).toFixed(2);
      total += parseFloat(itemTotal);
      doc.text([item.name,item.quantity.toString(),item.price.toFixed(2),itemTotal],15,y);
      y+=8;
    });
    doc.text("Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: "+total.toFixed(2)+" Ø¯.Ø£",15,y+10);
    doc.save("ÙØ§ØªÙˆØ±Ø©_Ø§Ù„Ø¹Ù…ÙŠÙ„.pdf");
  }

  // ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙƒØµÙˆØ±Ø© PNG
  function downloadInvoiceImage() {
    const invoice = document.getElementById("invoiceCard");
    html2canvas(invoice).then(canvas=>{
      const link = document.createElement("a");
      link.download = "ÙØ§ØªÙˆØ±Ø©_Ø§Ù„Ø¹Ù…ÙŠÙ„.png";
      link.href = canvas.toDataURL();
      link.click();
    });
  }

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©: ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙˆØ§Ù„ÙØ§ØªÙˆØ±Ø©
  updateProductsTable();
</script>

</body>
</html>
